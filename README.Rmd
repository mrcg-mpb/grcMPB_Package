---
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## MPB grcMalaria Package
This README provides a workflow example demonstrating the main functions in the MPB grcMalaria package.

### Creating the Final GRC Data
The `Combine_GRC_Sheets` function combines multiple GRC sheets into a final dataset for analysis. 
```{r, echo = TRUE, eval = FALSE}

GRC_Data <-
    Combine_GRC_Sheets(input_folder="C:/Users/bngwa/Documents/Brandon/GDA_Markdown/All_GRC_Reads_Gambia",
                       Country = "Gambia", 
                       save_output = TRUE)
```


### Create the drug status columns
Gene_Classifier assigns drug status based on specified genetic markers, helping identify resistance and sensitivity profiles.
```{r, echo = TRUE, eval = FALSE}

GRC_Data <-
  Gene_Classifier(df = GRC_Data, 
                  drug_column = "Chloroquine")
```


### Preparing Metadata for Mapping
Before creating maps, load geographic shapefiles and longitude/latitude data, then use MappingData to format the data for mapping.
```{r, echo = TRUE, eval = FALSE}
## load the shapefile for Gambia first
GMB <- st_read("C:/Users/bngwa/Documents/Brandon/GDA_Markdown/geoBoundaries-GMB-ADM3-all/geoBoundaries-GMB-ADM3-all/geoBoundaries-GMB-ADM3_simplified.shp")

## Read the logitude and latitude data
LongLat <- read_excel("C:/Users/bngwa/Documents/Brandon/GDA_Markdown/LongLat_data.xlsx")

mapping_data <- 
MappingData(shapefile = GMB ,
            LongLat_data = LongLat,
            location_col = "Location",
            long_col = "long",
            lat_col = "lat" )


```

### Setting Time Periods
Define specific time periods to filter data when generating plots. Below is an example of a list specifying individual years and ranges.
```{r}
## You can creat a single or range of years to filter buy before generating the plots
Periods <-
  list( list(name="2021", type ="year", start="2021"),
        list(name="2017-19",  type= "period", start="2017",  end="2019"))
```


### Generating a Sample Count Map
Create a map displaying sample counts across different locations, adjusting parameters for circle size and map labels.
```{r, echo = TRUE, eval = FALSE}

SampleCountMap(df = GRC_Data, 
               drug_col = "Chloroquine",
               mData = mapping_data,
               time = Periods,
               breaks = c(10, 100, 200, 300),
               label_size = 2.5, 
               scale_circle_size = 11,
               save_output = TRUE)

```


#### Producing a Drug Distribution Table and Bar Chart
Generate bar charts showing the proportion of the diffrent conditions for th slected drug.
```{r, echo = TRUE, eval = FALSE}

Drug_Distribution(df = GRC_Data, 
                  drug_col = "Chloroquine",
                  save_output = FALSE,
                  time = Periods,
                  colors = c("Resistant" = "#525CEB",
                             "Mixed.Resistant" = "#808000",
                             "Sensitive" = "#800000") )
```


#### Mapping Drug Resistance Prevalence Proportion
The Proportion_Map function visualizes the proportion of the drug condtions in various locations, with options for customizing label and circle sizes.
```{r, echo = TRUE, eval = FALSE}

Proportion_Map(df = GRC_Data, 
               drug_col = "Chloroquine",
               save_output = FALSE,
               time = NULL,
               mData = mapping_data,
               label_size = 2.5,
               circle_num_size = 3.1, 
               scale_circle_size = 10)
               
```
